<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Super Ular Tangga Online</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Varela+Round&display=swap" rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore-compat.js"></script>

    <style>
        body {
            font-family: 'Varela Round', sans-serif;
            background-color: #3b82f6;
            background-image: url("https://www.transparenttextures.com/patterns/cubes.png"), radial-gradient(circle, #60a5fa 0%, #1e40af 100%);
            background-blend-mode: overlay;
            color: #1e293b;
            overflow: hidden; 
            user-select: none;
            touch-action: none; /* Prevent pull-to-refresh on mobile */
        }
        
        .pixel-font { font-family: 'Press Start 2P', cursive; }
        
        /* Glassmorphism Panels (HUD) */
        .hud-panel {
            background: rgba(15, 23, 42, 0.95);
            border: 2px solid #475569;
            backdrop-filter: blur(8px);
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5);
            transition: all 0.3s ease;
            position: relative;
            min-width: 220px;
            padding: 12px;
            z-index: 30; /* Ensure above board */
        }
        
        .hud-panel.active-turn {
            border-color: #facc15;
            box-shadow: 0 0 20px rgba(250, 204, 21, 0.5);
            transform: scale(1.02);
            z-index: 35;
            background: rgba(30, 41, 59, 0.98);
        }

        /* Rank Badge */
        .rank-badge {
            position: absolute; top: -15px; right: -10px; width: 45px; height: 45px;
            background: linear-gradient(135deg, #f59e0b, #fbbf24); border: 3px solid #fff; border-radius: 50%;
            display: flex; justify-content: center; align-items: center; font-weight: 900; color: #78350f;
            font-size: 1.1rem; box-shadow: 0 4px 6px rgba(0,0,0,0.4); z-index: 30; transform: rotate(5deg);
        }
        .rank-badge.rank-1 { background: linear-gradient(135deg, #facc15, #eab308); color: #713f12; font-size: 1.3rem; transform: scale(1.1); }
        .rank-badge.rank-2 { background: linear-gradient(135deg, #94a3b8, #cbd5e1); color: #0f172a; }
        .rank-badge.rank-3 { background: linear-gradient(135deg, #b45309, #d97706); color: #fffbeb; }

        /* Progress Bar (Finish Bar) */
        .finish-bar-container {
            width: 100%; height: 10px; background: #1e293b; border: 1px solid #475569;
            border-radius: 99px; margin-top: 8px; overflow: hidden; display: flex;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.5);
        }
        .finish-segment { flex: 1; background: transparent; border-right: 1px solid rgba(255,255,255,0.1); transition: all 0.5s ease; }
        .finish-segment:last-child { border-right: none; }
        .finish-segment.filled { background: linear-gradient(to bottom, #4ade80, #22c55e); box-shadow: inset 0 1px 0 rgba(255,255,255,0.4), 0 0 10px #4ade80; }

        /* HUD Pawn Grid */
        .hud-pawn-grid {
            display: flex; gap: 4px; justify-content: center; margin-top: 4px;
            background: rgba(0,0,0,0.3); padding: 4px; border-radius: 8px;
        }
        .hud-pawn-slot {
            width: 24px; height: 24px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            background: rgba(255,255,255,0.05); border: 1px dashed rgba(255,255,255,0.2);
            font-size: 0.7rem; transition: all 0.2s;
        }
        .hud-pawn-slot.filled { border-style: solid; background: rgba(255,255,255,0.1); box-shadow: inset 0 0 5px rgba(0,0,0,0.5); }
        .hud-pawn-slot.spawnable { cursor: pointer; border-color: #facc15; background: rgba(250, 204, 21, 0.2); animation: pulse 1s infinite; }
        .hud-pawn-slot.spawnable:hover { transform: scale(1.1); }
        .hud-pawn-slot.empty { display: none; }

        /* Action Button */
        .btn-action {
            background: linear-gradient(to bottom, #fbbf24, #d97706); border: none; border-bottom: 6px solid #92400e;
            border-radius: 999px; color: white; font-weight: 900; text-transform: uppercase; letter-spacing: 1px;
            text-shadow: 0 2px 0 rgba(0,0,0,0.2); transition: all 0.1s;
        }
        .btn-action:active:not(:disabled) { transform: translateY(4px); border-bottom-width: 2px; }
        .btn-action:disabled { background: #64748b; border-bottom-color: #334155; cursor: not-allowed; transform: translateY(4px); border-bottom-width: 2px; }

        /* Pawn Selection Buttons */
        .pawn-select-btn {
            background: rgba(15, 23, 42, 0.9); border: 2px solid #facc15; color: white;
            padding: 10px 15px; border-radius: 12px; margin-bottom: 8px;
            display: flex; align-items: center; gap: 10px; cursor: pointer;
            transition: all 0.2s; animation: slideInRight 0.3s forwards;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3); text-align: left; width: 180px;
        }
        .pawn-select-btn:hover { background: #facc15; color: #78350f; transform: translateX(-5px); }
        .pawn-select-btn i { font-size: 1.2rem; }
        
        @keyframes slideInRight { from { opacity: 0; transform: translateX(50px); } to { opacity: 1; transform: translateX(0); } }

        .avatar-circle { width: 120px; height: 120px; border-radius: 50%; border: 4px solid #e2e8f0; display: flex; align-items: center; justify-content: center; font-size: 3.5rem; transition: all 0.3s; background: #f8fafc; }
        .hud-avatar { width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; border: 3px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.5); }
        .hud-avatar-container {
            position: relative; width: 64px; height: 64px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            background: #475569; padding: 3px; box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }

        .input-gartic { border: 2px solid #cbd5e1; border-radius: 12px; padding: 12px; font-size: 1.1rem; text-align: center; font-weight: bold; color: #475569; outline: none; transition: border-color 0.2s; }
        .input-gartic:focus { border-color: #3b82f6; }

        /* Board */
        .board-grid { 
            display: grid; grid-template-columns: repeat(10, 1fr); gap: 1px; 
            background-color: #334155; border: 6px solid #475569; border-radius: 12px; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.5); position: relative; 
            width: 100%; max-width: 600px; aspect-ratio: 1;
            transition: all 0.3s ease;
        }
        .board-cell { aspect-ratio: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 0.6rem; position: relative; background-color: #1e293b; border-radius: 1px; color: rgba(255,255,255,0.6); overflow: hidden; }
        .board-cell:nth-child(even) { background-color: #0f172a; }
        .board-cell span { font-weight: 900; z-index: 1; text-shadow: 0 2px 2px rgba(0,0,0,0.8); font-size: 0.7rem; position: absolute; top: 3px; left: 4px; opacity: 0.9; color: #e2e8f0; }
        
        /* Cell 0 / Start Box */
        #cell-0 {
            position: absolute; bottom: 5px; left: -50px; width: 40px; height: 40px;
            background: linear-gradient(135deg, #10b981, #059669); border: 3px solid #fff; border-radius: 8px;
            display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 6px rgba(0,0,0,0.3); z-index: 10;
        }
        #cell-0::after { content: "START"; position: absolute; bottom: -15px; left: 50%; transform: translateX(-50%); font-size: 0.5rem; color: #fff; font-weight: bold; text-shadow: 0 1px 2px black; }

        .snake-path { background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(239, 68, 68, 0.4)); }
        .ladder-path { background: linear-gradient(135deg, rgba(34, 197, 94, 0.15), rgba(34, 197, 94, 0.4)); }
        
        /* Token */
        .player-token { 
            width: 22px; height: 22px; border-radius: 50%; border: 2px solid white; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.8);
            display: flex; align-items: center; justify-content: center;
            font-size: 0.7rem; transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            position: absolute; z-index: 50; cursor: default;
        }
        .token-selectable { cursor: pointer !important; animation: bounceSelect 1s infinite; border: 3px solid #facc15 !important; box-shadow: 0 0 15px #facc15, 0 0 30px #facc15 !important; z-index: 100 !important; transform: scale(1.3) !important; }
        .token-number { font-weight: bold; color: white; text-shadow: 0 1px 2px black; }

        .dest-indicator { position: absolute; font-weight: bold; font-size: 0.5rem; opacity: 0.8; z-index: 5; background: rgba(0,0,0,0.6); padding: 1px 3px; border-radius: 4px; pointer-events: none; }
        .dest-indicator.up { bottom: 2px; right: 2px; color: #4ade80; }
        .dest-indicator.down { bottom: 2px; right: 2px; color: #f87171; }

        /* CONTROL HUB (Right Side Default) */
        #control-hub {
            position: absolute;
            top: 50%;
            right: 30px;
            transform: translateY(-50%);
            z-index: 50;
            display: flex;
            flex-direction: column-reverse; /* Button bottom, text top */
            align-items: flex-end; /* Align right */
            gap: 10px;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        #control-hub.hub-hidden { opacity: 0; transform: translate(100px, -50%); pointer-events: none; }

        /* DICE VISUAL */
        #dice-visual-wrapper { 
            position: absolute; top: 40%; right: 40px; transform: translateY(-50%);
            width: 100px; height: 100px; pointer-events: none; 
            display: flex; justify-content: center; align-items: center; z-index: 60;
        }

        /* LEADERBOARD SIDEBAR */
        #leaderboard-sidebar {
            position: absolute; left: 20px; top: 50%; transform: translateY(-50%); width: 200px;
            background: rgba(15, 23, 42, 0.95); border: 2px solid #facc15; border-radius: 12px; padding: 15px;
            z-index: 40; box-shadow: 5px 5px 15px rgba(0,0,0,0.5); transition: all 0.3s;
        }
        .lb-item { display: flex; align-items: center; gap: 8px; padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.1); color: white; font-size: 0.8rem; }
        .lb-item:last-child { border-bottom: none; }
        .lb-rank { width: 24px; height: 24px; background: #334155; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-weight: bold; font-size: 0.7rem; }
        .lb-rank.top-1 { background: #facc15; color: #78350f; }
        .lb-rank.top-2 { background: #94a3b8; color: #0f172a; }
        .lb-rank.top-3 { background: #b45309; color: #fffbeb; }

        /* Connection Status */
        #conn-status {
            position: absolute; bottom: 10px; left: 10px; font-size: 0.7rem; color: rgba(255,255,255,0.5);
            z-index: 100;
        }

        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #facc15; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        
        .scene { width: 80px; height: 80px; perspective: 400px; } 
        .cube { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; transform: translateZ(-40px); transition: transform 1s ease-out; }
        .cube.rolling { animation: spinDice 0.6s infinite linear; }
        .cube__face { position: absolute; width: 80px; height: 80px; border: 3px solid #b45309; background: #facc15; display: flex; justify-content: center; align-items: center; font-size: 40px; color: #78350f; border-radius: 12px; box-shadow: inset 0 0 15px rgba(0,0,0,0.1); backface-visibility: hidden; }
        .cube__face--1  { transform: rotateY(  0deg) translateZ(40px); }
        .cube__face--2  { transform: rotateY(180deg) translateZ(40px); }
        .cube__face--3  { transform: rotateY( 90deg) translateZ(40px); }
        .cube__face--4  { transform: rotateY(-90deg) translateZ(40px); }
        .cube__face--5  { transform: rotateX( 90deg) translateZ(40px); }
        .cube__face--6  { transform: rotateX(-90deg) translateZ(40px); }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes spinDice { 
            0% { transform: translateZ(-40px) rotateX(0deg) rotateY(0deg) rotateZ(0deg); } 
            100% { transform: translateZ(-40px) rotateX(360deg) rotateY(360deg) rotateZ(360deg); } 
        }
        @keyframes bounceSelect { 0%, 100% { transform: scale(1.2); } 50% { transform: scale(1.4); } }
        @keyframes pulse { 0% { opacity: 0.6; } 50% { opacity: 1; } 100% { opacity: 0.6; } }

        /* --- MOBILE / RESPONSIVE OPTIMIZATION --- */
        @media (max-width: 768px) {
            /* Container Layout */
            #game-screen {
                display: flex !important;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                padding: 0;
            }

            /* Board Scale & Position */
            .board-grid { 
                max-width: 92vw; 
                margin: 0 auto;
                /* Center board vertically, slightly up to make room for bottom controls */
                margin-bottom: 100px; 
                margin-top: 40px;
            } 

            /* Compact HUD Panels */
            .hud-panel { 
                transform: none; 
                transform-origin: center; 
                min-width: auto;
                width: 140px; 
                padding: 6px;
                border-radius: 10px;
            }
            
            /* HUD Positioning (Top & Bottom Corners) */
            #hud-p0 { top: 10px; left: 10px; }
            #hud-p1 { top: 10px; right: 10px; flex-direction: row; } /* Force normal direction */
            
            /* Bottom HUDs slightly above controls */
            #hud-p3 { bottom: 20px; left: 10px; }
            #hud-p2 { bottom: 20px; right: 10px; flex-direction: row; }

            /* HUD Content Scaling */
            .hud-avatar-container { width: 40px; height: 40px; padding: 2px; }
            .hud-avatar { width: 32px; height: 32px; font-size: 1rem; }
            .rank-badge { width: 24px; height: 24px; font-size: 0.7rem; top: -8px; right: -8px; border-width: 2px; }
            .hud-panel .text-lg { font-size: 0.9rem; } /* Score */
            .hud-panel .truncate { font-size: 0.65rem; max-width: 80px; } /* Name */
            .finish-bar-container { height: 6px; margin-top: 4px; }
            .hud-pawn-grid { gap: 2px; margin-top: 2px; padding: 2px; }
            .hud-pawn-slot { width: 16px; height: 16px; font-size: 0.5rem; border-width: 1px; }

            /* Hide Leaderboard on Mobile */
            #leaderboard-sidebar { display: none; }
            
            /* Controls: Move to Bottom Center (Thumb accessible) */
            #control-hub { 
                right: auto;
                top: auto;
                bottom: 30px;
                left: 50%;
                transform: translateX(-50%);
                align-items: center;
                width: 100%;
                pointer-events: none; /* Let clicks pass through wrapper */
            }
            #control-hub.hub-hidden {
                transform: translate(-50%, 100px); /* Slide down */
            }
            
            #control-hub button, #control-hub #pawn-choice-container {
                pointer-events: auto; /* Re-enable clicks */
            }

            /* Action Button Bigger for Thumb */
            .btn-action { 
                padding: 15px 40px; 
                font-size: 1.2rem; 
                box-shadow: 0 10px 20px rgba(0,0,0,0.5);
                z-index: 100;
            }
            
            /* Pawn Choice Container (Horizontal Scroll or Stack) */
            #pawn-choice-container {
                align-items: center;
                width: 100%;
                max-height: 200px;
                overflow-y: auto;
                margin-bottom: 10px;
                padding-bottom: 5px;
            }
            .pawn-select-btn {
                width: 90%;
                max-width: 300px;
                padding: 10px;
                background: rgba(15, 23, 42, 0.95);
            }

            /* Dice Visual: Center Screen */
            #dice-visual-wrapper { 
                top: 50%; 
                left: 50%; 
                right: auto; 
                transform: translate(-50%, -50%);
                z-index: 80; /* Above board but below overlays */
            }

            /* Start Cell Fix */
            #cell-0 { left: -30px; width: 30px; height: 30px; bottom: 0; border-width: 2px; }
            #cell-0::after { font-size: 0.3rem; bottom: -12px; }
            
            /* Token Size */
            .player-token { width: 16px; height: 16px; font-size: 0.5rem; box-shadow: 0 1px 2px rgba(0,0,0,0.8); }
            .token-selectable { transform: scale(1.5) !important; box-shadow: 0 0 10px #facc15 !important; }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">
    <!-- ... (HTML Content remains same as previous robust version) ... -->
